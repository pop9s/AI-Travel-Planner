# 🔧 修复 USERKEY_PLAT_NOMATCH 错误

## 错误说明

如果您看到错误码 `USERKEY_PLAT_NOMATCH`，这表示您的**高德地图 API Key 的平台类型不匹配**。

这个错误通常发生在：
- API Key 的平台设置不是 "Web 端（JS API）"
- API Key 是为其他平台（如 Android、iOS）配置的

## ✅ 解决步骤

### 步骤 1：登录高德开放平台

1. 访问 [高德开放平台控制台](https://console.amap.com/)
2. 使用您的账号登录

### 步骤 2：找到您的应用和 Key

1. 点击左侧菜单 **"应用管理"** > **"我的应用"**
2. 找到您正在使用的应用
3. 点击应用名称进入详情页

### 步骤 3：修改 Key 的平台设置

1. 在应用详情页，找到 **"Key 列表"** 或 **"Key 管理"**
2. 找到您正在使用的 Key（通常是 `NEXT_PUBLIC_AMAP_KEY` 对应的 Key）
3. 点击 Key 右侧的 **"设置"** 或 **"编辑"** 按钮

### 步骤 4：选择正确的服务平台

1. 在 Key 设置页面，找到 **"服务平台"** 或 **"服务类型"** 选项
2. **必须勾选**：**"Web 端（JS API）"**
3. 可以同时勾选其他需要的平台（如需要）
4. 点击 **"保存"** 或 **"提交"**

### 步骤 5：等待生效

1. 保存后，等待 **2-5 分钟** 让设置生效
2. 刷新您的应用页面
3. 重新尝试搜索功能

## 📸 操作示意图

```
高德开放平台控制台
├── 应用管理
│   └── 我的应用
│       └── [您的应用名称]
│           └── Key 列表
│               └── [您的 Key]
│                   └── 设置/编辑
│                       └── 服务平台
│                           ✅ Web 端（JS API）  ← 必须勾选这个
│                           ☐ Android 平台
│                           ☐ iOS 平台
│                           ☐ 服务端
```

## ⚠️ 注意事项

### 1. 确保选择了正确的平台

- ✅ **必须选择**：`Web 端（JS API）`
- ❌ **不要只选择**：Android、iOS 或其他平台

### 2. 可以同时选择多个平台

如果您的 Key 需要用于多个平台，可以同时勾选：
- ✅ Web 端（JS API）
- ✅ Android 平台（如果需要）
- ✅ iOS 平台（如果需要）

### 3. 修改后需要等待

- 修改 Key 设置后，通常需要 **2-5 分钟** 才能生效
- 如果立即测试仍然失败，请等待几分钟后重试

### 4. 检查 Key 是否正确

确保您在 `.env.local` 文件中使用的 Key 与高德控制台中的 Key 一致。

## 🔍 验证修复

修复后，请按以下步骤验证：

1. **等待 2-5 分钟**（让设置生效）
2. **刷新应用页面**（F5 或 Ctrl+R）
3. **打开浏览器控制台**（F12）
4. **尝试搜索**（例如："北京天安门"）
5. **查看控制台**，应该看到：
   ```
   ✅ 搜索成功，找到 X 个结果
   ```
   而不是：
   ```
   ❌ USERKEY_PLAT_NOMATCH
   ```

## 🆘 如果仍然失败

### 检查清单

- [ ] 已选择 "Web 端（JS API）" 平台
- [ ] 已保存设置
- [ ] 已等待 2-5 分钟
- [ ] 已刷新页面
- [ ] Key 与 `.env.local` 中的一致
- [ ] 已重启开发服务器（如果修改了 `.env.local`）

### 其他可能的问题

如果修改平台设置后仍然失败，可能是：

1. **Key 未开通搜索服务**
   - 在 Key 设置中检查是否开通了"地点搜索"服务

2. **Key 配额用完**
   - 检查 API 使用量和配额限制

3. **网络问题**
   - 检查网络连接是否正常
   - 检查是否有防火墙阻止了请求

## 📞 获取帮助

如果按照以上步骤操作后仍然无法解决问题：

1. **查看高德地图官方文档**：
   - [高德地图 JavaScript API 文档](https://lbs.amap.com/api/javascript-api/summary)
   - [错误码说明](https://lbs.amap.com/api/webservice/guide/tools/info)

2. **联系高德技术支持**：
   - 在高德开放平台控制台提交工单

3. **检查项目文档**：
   - [高德地图配置指南](./AMAP_SETUP.md)
   - [搜索功能故障排查](./SEARCH_TROUBLESHOOTING.md)

---

**修复后，搜索功能应该可以正常工作了！** 🎉

