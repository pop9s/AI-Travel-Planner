# 🧭 导航功能使用指南

## 📍 问题解决：无法导航到指定地点

如果您遇到"无法导航到指定地点"的问题，请按照以下步骤操作：

## ✅ 解决方案

### 方法 1：获取当前位置（推荐）

导航功能需要知道您的**当前位置**作为起点。请按以下步骤操作：

1. **打开地图导航区域**
   - 在主页找到 "🗺️ 地图导航与位置服务" 卡片
   - 点击 "显示地图" 按钮

2. **获取当前位置**
   - 在地图上方找到 **"获取当前位置"** 按钮
   - 点击按钮
   - **允许浏览器访问您的位置**（浏览器会弹出权限请求）
   - 等待位置获取成功

3. **使用导航功能**
   - 搜索或选择一个目的地
   - 点击 **"导航"** 按钮
   - 系统会自动规划从您当前位置到目标地点的路线

### 方法 2：使用搜索功能选择目的地

1. **搜索目的地**
   - 在地图搜索框中输入地点名称
   - 例如："北京故宫"、"上海外滩"
   - 按 Enter 或点击搜索按钮

2. **选择搜索结果**
   - 点击搜索结果列表中的地点
   - 地图会自动定位到该地点

3. **开始导航**
   - 点击地点卡片上的 **"导航"** 按钮
   - 系统会规划路线

### 方法 3：从旅行计划自动定位

1. **生成旅行计划**
   - 在表单中填写目的地（如：北京）
   - 点击 "生成AI旅行计划"
   - 地图会自动定位到目的地

2. **使用导航**
   - 点击目的地标记或地点卡片
   - 点击 **"导航"** 按钮

## 🔧 常见问题排查

### 问题 1：点击导航没有反应

**可能原因**：
- 未获取当前位置
- 地图未完全加载
- API Key 未配置

**解决方法**：
1. 先点击 "获取当前位置" 按钮
2. 允许浏览器位置权限
3. 等待位置获取成功后再点击导航

### 问题 2：提示"无法获取当前位置"

**可能原因**：
- 浏览器拒绝了位置权限
- 设备不支持定位
- 网络问题

**解决方法**：

#### 步骤 1：允许浏览器位置权限

**Chrome/Edge**：
1. 点击地址栏左侧的锁图标 🔒
2. 找到 "位置" 权限
3. 选择 "允许"
4. 刷新页面

**Firefox**：
1. 点击地址栏左侧的锁图标 🔒
2. 点击 "更多信息"
3. 在"权限"标签中找到"位置"
4. 选择 "允许"
5. 刷新页面

**Safari**：
1. Safari > 偏好设置 > 网站
2. 找到位置服务
3. 设置为 "允许"

#### 步骤 2：检查设备定位功能

- **桌面端**：确保网络连接正常
- **移动端**：确保 GPS 和位置服务已开启

#### 步骤 3：使用备用方案

如果浏览器定位失败，系统会自动尝试使用高德地图定位服务。

### 问题 3：路线规划失败

**可能原因**：
- 起点或终点坐标无效
- 起点和终点距离过远
- 网络问题

**解决方法**：
1. 检查起点和终点是否都在中国大陆范围内
2. 确保网络连接正常
3. 尝试重新获取位置
4. 检查浏览器控制台是否有错误信息

### 问题 4：地图显示但无法搜索

**可能原因**：
- API Key 未配置或配置错误
- API Key 权限不足

**解决方法**：
1. 检查 `.env.local` 文件中的 `NEXT_PUBLIC_AMAP_KEY`
2. 确认 API Key 的服务平台选择了 "Web 端（JS API）"
3. 重启开发服务器
4. 查看浏览器控制台的错误信息

## 📱 使用流程示例

### 完整导航流程

```
1. 打开应用主页
   ↓
2. 点击 "显示地图" 按钮
   ↓
3. 点击 "获取当前位置" 按钮
   ↓
4. 允许浏览器位置权限
   ↓
5. 等待位置获取成功（显示 ✅）
   ↓
6. 在搜索框输入目的地（如："北京天安门"）
   ↓
7. 点击搜索结果或地图上的标记
   ↓
8. 点击 "导航" 按钮
   ↓
9. 查看路线规划结果（距离、时间）
   ↓
10. 在地图上查看路线和起点/终点标记
```

## 🎯 功能说明

### 导航功能特点

1. **智能定位**
   - 优先使用浏览器定位（最准确）
   - 备用高德地图定位服务
   - 最后使用地图中心作为起点

2. **路线规划**
   - 自动计算驾车路线
   - 显示距离（公里）和预计时间（分钟）
   - 在地图上绘制路线

3. **可视化标记**
   - 起点标记（绿色）
   - 终点标记（红色）
   - 路线高亮显示

4. **错误提示**
   - 清晰的错误信息提示
   - 操作建议和解决方案

## 💡 使用技巧

### 技巧 1：提前获取位置

在需要使用导航前，先点击 "获取当前位置" 按钮，这样导航时就不需要等待定位了。

### 技巧 2：多地点导航

1. 搜索第一个地点并导航
2. 查看路线信息
3. 搜索第二个地点
4. 再次导航查看新路线

### 技巧 3：结合旅行计划

1. 生成旅行计划后，地图会自动定位到目的地
2. 搜索计划中推荐的景点
3. 使用导航功能规划实际游览路线

## 🔍 调试方法

### 查看控制台日志

1. 按 `F12` 打开开发者工具
2. 切换到 "Console" 标签
3. 查看以下日志：
   - `✅ 获取到当前位置:` - 位置获取成功
   - `✅ 路线规划成功` - 导航成功
   - `❌ 路线规划失败` - 导航失败
   - `⚠️ 使用地图中心作为起点` - 定位失败，使用备用方案

### 检查网络请求

1. 打开开发者工具
2. 切换到 "Network" 标签
3. 点击导航按钮
4. 查看是否有失败的请求
5. 检查请求的 URL 和响应

## 📞 获取帮助

如果以上方法都无法解决问题，请：

1. **查看浏览器控制台**的错误信息
2. **检查 API Key 配置**是否正确
3. **查看详细文档**：
   - [地图导航功能说明](../README_MAP_FEATURE.md)
   - [高德地图配置指南](./AMAP_SETUP.md)
   - [地图使用指南](./MAP_USAGE_GUIDE.md)

## ✅ 快速检查清单

使用导航功能前，请确认：

- [ ] 已配置高德地图 API Key
- [ ] 已重启开发服务器
- [ ] 浏览器允许位置权限
- [ ] 网络连接正常
- [ ] 地图已完全加载
- [ ] 已获取当前位置（或系统自动获取）

---

**现在您可以正常使用导航功能了！** 🧭✨

如果还有问题，请查看浏览器控制台的错误信息，或参考其他相关文档。

