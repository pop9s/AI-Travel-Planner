# 🗺️ 地图导航功能使用指南

## 🎯 快速开始

地图导航功能现已集成到主页面，您可以直接看到和使用！

## 📍 在哪里找到地图导航？

### 方式 1：主页地图导航区域（推荐）

1. 打开应用主页：http://localhost:3002
2. 在页面顶部（标题下方）可以看到 **"🗺️ 地图导航与位置服务"** 卡片
3. 点击 **"显示地图"** 按钮即可展开地图

### 方式 2：旅行计划详情页

1. 创建并保存一个旅行计划
2. 在 "我的计划" 中打开计划详情
3. 可以看到目的地地图和导航功能

## 🔧 配置步骤

### 第一步：配置高德地图 API Key

要使用地图功能，需要先配置高德地图 API Key：

1. **获取 API Key**：
   - 访问 [高德开放平台](https://lbs.amap.com/)
   - 注册并创建应用
   - 获取 Web 服务（JS API）Key

2. **配置环境变量**：
   
   在 `.env.local` 文件中添加：
   ```bash
   # 高德地图 API 密钥
   NEXT_PUBLIC_AMAP_KEY=你的高德地图Key
   NEXT_PUBLIC_AMAP_SECURITY_KEY=你的安全密钥（可选）
   ```

3. **重启服务器**：
   ```bash
   # 停止服务器（Ctrl+C）
   npm run dev
   ```

**详细配置指南**：[docs/AMAP_SETUP.md](./AMAP_SETUP.md)

## 🎨 功能演示

### 功能 1：查看和隐藏地图

- **显示地图**：点击 "显示地图" 按钮
- **隐藏地图**：点击 "隐藏地图" 按钮
- 地图默认显示北京天安门位置

### 功能 2：搜索地点

1. 点击 "显示地图" 按钮打开地图
2. 在搜索框中输入地点名称：
   - 例如："北京故宫"、"上海外滩"、"成都火锅"
3. 按 Enter 或点击搜索按钮
4. 地图会显示搜索结果并自动定位

### 功能 3：自动定位目的地

1. 在旅行计划表单中填写 **"目的地"**
   - 例如：北京、上海、杭州
2. 填写其他必填信息并点击 **"生成AI旅行计划"**
3. 地图会 **自动定位** 到您填写的目的地
4. 在地图上会显示目的地标记

### 功能 4：查看地点详情

1. 点击地图上的标记点
2. 会弹出信息窗口，显示：
   - 地点名称
   - 详细地址
   - 地点类型

### 功能 5：路线规划与导航

1. 搜索或选择一个目的地
2. 点击地点卡片上的 **"导航"** 按钮
3. 系统会规划从当前位置到目标地点的驾车路线
4. 显示：
   - 距离（公里）
   - 预计时间（分钟）
   - 路线在地图上绘制

### 功能 6：地点列表

- 当有多个地点时，会在地图下方显示地点列表
- 点击列表中的地点可以在地图上定位
- 每个地点都有独立的导航按钮

## 📱 界面说明

### 未展开地图时

```
┌─────────────────────────────────────────┐
│ 🗺️ 地图导航与位置服务    [显示地图] │
│ 搜索目的地、景点、餐厅等              │
│                                         │
│      探索地图导航功能                  │
│    点击"显示地图"开始使用              │
│                                         │
│  🔍 智能搜索  🧭 路线规划  📍 地点标记 │
└─────────────────────────────────────────┘
```

### 展开地图后

```
┌─────────────────────────────────────────┐
│ 🗺️ 地图导航与位置服务    [隐藏地图] │
│ 搜索目的地、景点、餐厅等              │
├─────────────────────────────────────────┤
│ [搜索框：输入地点名称...]        [🔍] │
│                                         │
│ ┌───────────────────────────────────┐ │
│ │                                   │ │
│ │        🗺️ 高德地图              │ │
│ │          📍 标记点               │ │
│ │                                   │ │
│ └───────────────────────────────────┘ │
│                                         │
│ 📍 北京市                              │
│ 北京市东城区天安门广场                │
│                           [🧭 导航]    │
└─────────────────────────────────────────┘
```

## 🎯 使用场景

### 场景 1：规划北京旅行

1. 在 "目的地" 输入框填写：**北京**
2. 填写其他信息并生成旅行计划
3. 地图自动定位到北京
4. 搜索 "故宫" 查看位置
5. 点击 "导航" 查看路线

### 场景 2：搜索周边美食

1. 点击 "显示地图"
2. 在搜索框输入：**上海南京路美食**
3. 查看搜索结果列表
4. 点击感兴趣的餐厅查看详情
5. 使用导航功能规划路线

### 场景 3：多地点行程规划

1. 填写目的地并生成旅行计划
2. 在地图搜索多个景点
3. 查看各景点在地图上的位置分布
4. 使用导航功能估算各地点间的距离

## ❓ 常见问题

### Q1: 看不到地图导航区域？

**A**: 地图导航区域位于主页标题下方，在旅行计划表单上方。如果看不到：
1. 刷新页面（Ctrl+R 或 F5）
2. 检查页面是否完全加载
3. 向下滚动查看

### Q2: 点击"显示地图"没有反应？

**A**: 可能是以下原因：
1. **未配置 API Key**：请先配置高德地图 API Key
2. **服务器未重启**：配置后需要重启开发服务器
3. **网络问题**：检查网络连接是否正常

### Q3: 地图显示空白或加载失败？

**A**: 
1. **检查 API Key**：
   - 打开浏览器控制台（F12）
   - 查看是否有 API Key 相关错误
   - 验证 `.env.local` 中的配置

2. **检查 Key 权限**：
   - 登录高德开放平台
   - 确认 Key 的服务平台选择了 "Web 端（JS API）"
   - 检查 Key 是否有效

3. **查看控制台**：
   - 按 F12 打开开发者工具
   - 查看 Console 标签的错误信息
   - 根据错误提示排查问题

### Q4: 搜索没有结果？

**A**: 
1. 尝试更具体的搜索词（如："北京故宫" 而不是 "故宫"）
2. 确认搜索的地点在中国大陆范围内
3. 检查网络连接是否正常

### Q5: 无法自动定位目的地？

**A**: 
1. 确保在 "目的地" 输入框填写了有效的城市或地点名称
2. 点击 "生成AI旅行计划" 后等待几秒
3. 如果仍然无法定位，手动使用搜索功能

### Q6: 不配置 API Key 能用其他功能吗？

**A**: 
✅ **能！** 地图功能是可选的：
- 旅行计划生成功能正常使用
- 费用管理功能正常使用
- 用户登录功能正常使用
- 语音输入功能正常使用
- 只有地图相关功能不可用

## 💡 使用技巧

### 技巧 1：结合旅行计划使用

1. 先生成旅行计划
2. 查看计划中推荐的景点
3. 在地图上搜索这些景点
4. 规划实际的游览路线

### 技巧 2：对比多个地点

1. 搜索第一个地点并查看位置
2. 搜索第二个地点
3. 使用导航功能查看两地距离
4. 规划最优游览顺序

### 技巧 3：探索周边

1. 定位到目的地城市
2. 搜索 "周边景点"、"附近美食" 等
3. 发现更多有趣的地方

### 技巧 4：保存常用地点

1. 创建并保存旅行计划后
2. 地图会记住该计划的目的地
3. 在计划详情页可以直接查看地图

## 🚀 进阶功能

### 自定义地图样式

地图组件支持自定义配置，开发者可以在代码中修改：

```tsx
<MapView
  locations={[...]}
  center={[116.397428, 39.90923]}
  zoom={13}
  enableSearch={true}
  enableNavigation={true}
  className="your-custom-class"
/>
```

### API 调用

您也可以直接调用地理编码 API：

```javascript
const response = await fetch('/api/geocode?address=北京天安门')
const data = await response.json()
console.log(data.location) // { lng: 116.397428, lat: 39.90923 }
```

## 📚 更多资源

- [高德地图 API 配置指南](./AMAP_SETUP.md)
- [地图导航功能说明](../README_MAP_FEATURE.md)
- [环境变量配置指南](./ENV_CONFIG_GUIDE.md)
- [高德地图官方文档](https://lbs.amap.com/api/javascript-api/summary)

## 🎉 开始使用

现在就打开应用主页，点击 **"显示地图"** 按钮，开始探索地图导航功能吧！

如果还没有配置 API Key，请先查看 [配置指南](./AMAP_SETUP.md) 进行配置。

---

**祝您使用愉快！** 🗺️✨

